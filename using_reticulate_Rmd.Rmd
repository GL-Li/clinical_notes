---
title: "Using python with reticulate"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
ref: https://rstudio.github.io/reticulate/

## Installation
### Install R reticulate package

The installation of reticulate is easy with `install.packages("reticulate")`. After installation, the first time you run it with `library(reticulate)`, you will be asked to download a miniconda environment for reticualte. You are [encouraged to do so]( https://blog.rstudio.com/2019/12/20/reticulate-1-14/) as it will save a lot of dependency problems. The miniconda is installed at `~/.local/share/r-miniconda`.


### Install python packages
The miniconda environment comes with Numpy installed. To install other Python packages, simply use `py_install()` as below.
```{r}
library(reticulate)
#py_install("pandas")
#py_install("matplotlib")
#py_install("scikit-learn")
```


## Use reticulate package
### Run pure python code

```{python}
import numpy as np
import matplotlib.pyplot as plt

x = np.linspace(0, 100, 1000)
y = (x - 50)**2
plt.plot(x, y)
```

### Use python objects in R
```{r}
plot(py$x, py$y)
```

### Use R objects in Pyhton
```{r}
aaa <- seq(0, 100, 0.1)
bbb <- (aaa - 50)^2
```

```{python}
plt.plot(r.aaa, r.bbb)
```
## A machine learning example
### Data prepration and visulization in R
We will create a R data.frame object and will use it in Python as a Pandas dataframe.
```{r}
library(ggplot2)

data("iris")
names(iris) <- c("sepal_length", "sepal_width", "petal_length", "petal_width", "species")

ggplot(iris, aes(sepal_length, sepal_width, color = species)) + 
    geom_point()

X = iris[, 1:4]
y = iris[, 5]
```

### Use R data.frame in Python for machine learning
```{python}
import numpy as np
import pandas as pd
from sklearn.cluster import KMeans

km = KMeans(n_clusters=3).fit(r.X)
pred = km.predict(r.X)
```

### Feed model results to R
```{r}
iris$pred <- as.factor(py$pred)
ggplot(iris, aes(sepal_length, sepal_width, color=pred)) + 
    geom_point()
```

